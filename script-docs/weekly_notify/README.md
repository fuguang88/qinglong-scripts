# 青龙面板 - 7天循环通知脚本

## 📋 脚本简介

这是一个专为青龙面板开发的7天循环通知脚本，根据星期几自动发送不同的通知内容。通知内容完全可自定义，支持灵活配置。

## 📦 脚本文件

| 文件名 | 说明 | 依赖 |
|--------|------|------|
| `weekly_notify.js` | 主脚本文件 | 无外部依赖 |
| `weekly_notify_config.json` | 配置文件 | - |

## 🚀 快速配置

### 1. 文件部署

将以下文件上传到青龙面板的脚本目录：
- `weekly_notify.js` - 主脚本
- `weekly_notify_config.json` - 配置文件（可选，脚本会自动创建）

### 2. 环境变量设置（可选）

在青龙面板 `环境变量` 中可添加以下配置：

```
变量名: WEEKLY_NOTIFY_TITLE
变量值: 我的每日提醒
备注: 通知标题前缀（可选）

变量名: WEEKLY_NOTIFY_CONFIG
变量值: /path/to/custom_config.json
备注: 自定义配置文件路径（可选）

变量名: WEEKLY_NOTIFY_ENABLED
变量值: true
备注: 是否启用通知（必需，设置为true才启用）
```

### 3. 定时任务配置

```
名称: 每日通知提醒
命令: task weekly_notify.js
定时规则: 0 9 * * *
状态: 运行中
备注: 每天上午9点发送通知
```

## 🔧 自定义配置

### 配置文件结构

`weekly_notify_config.json` 文件结构说明：

```json
{
  "title_prefix": "每日提醒",           // 通知标题前缀
  "notifications": {                   // 每天的通知配置
    "0": {                            // 周日 (0=周日, 1=周一, ..., 6=周六)
      "title": "周日 - 休息日",
      "content": "通知内容..."
    },
    "1": {                            // 周一
      "title": "周一 - 新的开始",
      "content": "通知内容..."
    }
    // ... 其他天的配置
  },
  "settings": {
    "enabled": true,                   // 是否启用通知
    "fallback_message": "默认消息"      // 备用消息
  }
}
```

### 修改通知内容

1. **编辑配置文件**：直接修改 `weekly_notify_config.json`
2. **支持 Markdown 格式**：内容中可使用 `\n` 换行
3. **支持 Emoji**：让通知更生动有趣
4. **灵活配置**：每天都可以设置不同的标题和内容

### 配置示例

```json
{
  "title_prefix": "工作提醒",
  "notifications": {
    "1": {
      "title": "周一 - 工作日开始",
      "content": "💼 新的一周开始了！\n\n今日任务：\n• 检查邮件\n• 参加晨会\n• 完成项目A\n\n加油！💪"
    },
    "5": {
      "title": "周五 - 准备周末",
      "content": "🎉 周五到了！\n\n• 完成本周总结\n• 整理桌面\n• 计划周末活动\n\n周末愉快！🌈"
    }
  }
}
```

## 📊 功能特性

### ✅ 核心功能
- **7天循环**：根据星期几发送不同通知
- **完全可配置**：通知内容不写死在代码中
- **自动创建配置**：首次运行自动生成默认配置
- **配置验证**：检查配置文件格式正确性
- **备用机制**：配置缺失时使用默认消息

### 🛡️ 安全特性
- **无外部依赖**：不需要安装额外的npm包
- **错误处理**：完善的异常处理机制
- **日志记录**：详细的执行日志
- **兼容性好**：支持有无sendNotify.js两种情况

### 🔧 灵活配置
- **环境变量支持**：可通过环境变量覆盖配置
- **自定义路径**：支持指定配置文件路径
- **开关控制**：可随时启用/禁用通知
- **备用消息**：配置缺失时的默认处理

## 📝 使用场景

### 工作提醒
```json
{
  "title_prefix": "工作助手",
  "notifications": {
    "1": {"title": "周一计划", "content": "制定本周工作计划..."},
    "3": {"title": "周三检查", "content": "检查项目进度..."},
    "5": {"title": "周五总结", "content": "完成周报总结..."}
  }
}
```

### 健康提醒
```json
{
  "title_prefix": "健康助手",
  "notifications": {
    "1": {"title": "周一运动", "content": "💪 新的一周，开始锻炼！"},
    "3": {"title": "周三体检", "content": "🏥 记得关注身体健康"},
    "6": {"title": "周六户外", "content": "🌳 周末户外活动时间"}
  }
}
```

### 学习提醒
```json
{
  "title_prefix": "学习计划",
  "notifications": {
    "1": {"title": "周一读书", "content": "📚 开始新的学习计划"},
    "4": {"title": "周四复习", "content": "📝 复习本周学习内容"},
    "0": {"title": "周日总结", "content": "📊 总结本周学习成果"}
  }
}
```

## 🐛 故障排除

### Q1: 脚本执行但没有收到通知？
**检查项目：**
- 环境变量 `WEEKLY_NOTIFY_ENABLED` 是否设置为 `true`
- 青龙面板通知设置是否正确
- 配置文件中 `settings.enabled` 是否为 `true`
- 查看执行日志中的错误信息

### Q2: 配置文件格式错误？
**解决方案：**
- 确保JSON格式正确（可使用在线JSON验证工具）
- 检查是否有多余的逗号或缺少引号
- 删除配置文件让脚本重新生成默认配置

### Q3: 通知内容显示不正确？
**检查项目：**
- 确认星期几的编号（0=周日, 1=周一, ..., 6=周六）
- 检查配置文件中对应日期的配置是否存在
- 查看日志中的"今天是"信息确认日期判断

### Q4: 想要临时禁用通知？
**解决方案：**
```bash
# 方法1：删除或修改环境变量
WEEKLY_NOTIFY_ENABLED=false  # 或直接删除该环境变量

# 方法2：修改配置文件
"settings": {"enabled": false}

# 方法3：暂停定时任务
```

## 📋 日志查看

执行日志示例：
```
[2025-01-23 09:00:01] [INFO] 青龙面板 - 7天循环通知脚本开始执行
[2025-01-23 09:00:01] [INFO] 正在加载通知配置...
[2025-01-23 09:00:01] [INFO] 成功加载配置文件: weekly_notify_config.json
[2025-01-23 09:00:01] [INFO] 今天是: 周二 (2)
[2025-01-23 09:00:01] [INFO] 准备发送通知: 每日提醒 - 周二 - 高效工作
[2025-01-23 09:00:01] [INFO] 内容长度: 89 字符
[2025-01-23 09:00:01] [INFO] 使用 sendNotify.js 发送通知
[2025-01-23 09:00:02] [INFO] 通知发送完成: {"success":true}
[2025-01-23 09:00:02] [INFO] 通知脚本执行完成
```

## 🔄 更新日志

### v1.0.0 (2025-01-23)
- ✨ 初始版本发布
- 🎯 支持7天循环通知
- 📝 完全可配置的通知内容
- 🔧 自动创建默认配置
- 📊 详细的执行日志
- 🛡️ 完善的错误处理

## 💡 使用建议

1. **定时设置**：建议设置在每天的固定时间，如上午9点
2. **内容长度**：通知内容不宜过长，建议控制在200字以内
3. **个性化**：根据个人需求自定义每天的通知内容
4. **测试运行**：修改配置后建议手动执行一次测试
5. **备份配置**：重要的配置文件建议做好备份

---

**注意事项：** 
- 脚本使用星期几判断（0=周日），请注意配置对应关系
- 支持中文内容和Emoji表情
- 配置文件修改后立即生效，无需重启